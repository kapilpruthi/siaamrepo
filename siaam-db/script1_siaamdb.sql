-- MySQL Script generated by MySQL Workbench
-- 10/23/15 21:26:26
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema siaamdb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema siaamdb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `siaamdb` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ;
-- -----------------------------------------------------
-- Schema new_schema1
-- -----------------------------------------------------
USE `siaamdb` ;

-- -----------------------------------------------------
-- Table `siaamdb`.`USER`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `siaamdb`.`USER` (
  `GUID` VARCHAR(36) NOT NULL COMMENT 'unique GUID',
  `ONLINE_ID` VARCHAR(128) NOT NULL,
  `ONLINE_ID_STAT` CHAR(1) NOT NULL,
  `PASSWORD_ALGO` VARCHAR(64) NULL,
  `PASSWORD` VARCHAR(512) NULL DEFAULT NULL,
  `PASSWORD_STATUS` CHAR(1) NULL DEFAULT NULL,
  `PASSWORD_EXP_DATE` DATETIME NULL DEFAULT NULL,
  `PASSWORD_LOCK_CNT` INT NULL DEFAULT NULL,
  `USER_ID1` VARCHAR(64) NULL DEFAULT NULL,
  `USER_ID2` VARCHAR(64) NULL DEFAULT NULL,
  `HOW_ADDED` VARCHAR(16) NULL DEFAULT NULL,
  `OPEN_DATE` DATETIME NULL DEFAULT NULL,
  `CLOSE_DATE` DATETIME NULL DEFAULT NULL,
  `USER_IND1` VARCHAR(8) NULL DEFAULT NULL,
  `USER_IND2` VARCHAR(8) NULL DEFAULT NULL,
  `USER_IND3` VARCHAR(8) NULL DEFAULT NULL,
  `USER_IND4` VARCHAR(8) NULL DEFAULT NULL,
  `LAST_LOGIN_TS` DATETIME NULL,
  `FIRST_NAME` varchar(30) NOT NULL,
  `LAST_NAME` varchar(30) NOT NULL,
  `CREATED_BY` VARCHAR(64) NULL DEFAULT NULL,
  `CREATED_TS` DATETIME NULL DEFAULT NULL,
  `UPDATED_BY` VARCHAR(64) NULL DEFAULT NULL,
  `UPDATED_TS` DATETIME NULL DEFAULT NULL,
  `SITE_ID` VARCHAR(32) NULL DEFAULT NULL,
  `ROLE` VARCHAR(45) NULL COMMENT 'user role',
  `ENABLED` TINYINT(4) NULL,
  `EMAIL` varchar(254) NOT NULL,
  INDEX `USER__IDX` (`ONLINE_ID` ASC),
  INDEX `USER__IDXv1` (`USER_ID1` ASC),
  PRIMARY KEY (`GUID`),
  UNIQUE INDEX `USER__UN` (`ONLINE_ID` ASC),
  UNIQUE INDEX `GUID_UNIQUE` (`GUID` ASC));

-- Devices --
CREATE TABLE IF NOT EXISTS `siaamdb`.`Device` (
  `Id` VARCHAR(100) NOT NULL COMMENT '',
  `TypeName` VARCHAR(45) NULL DEFAULT NULL COMMENT '',
  `Category` VARCHAR(45) NULL DEFAULT NULL COMMENT '',
  `OS` VARCHAR(45) NULL DEFAULT NULL COMMENT '',
  `IP` VARCHAR(45) NULL DEFAULT NULL COMMENT '',
  `Location` VARCHAR(45) NULL DEFAULT NULL COMMENT '',
  `UserAgent` VARCHAR(200) NULL DEFAULT NULL COMMENT '',
  `created_by` VARCHAR(45) NOT NULL COMMENT '',
  `created_date` DATETIME NOT NULL COMMENT '',
  `updated_by` VARCHAR(45) NOT NULL COMMENT '',
  `updated_date` DATETIME NOT NULL COMMENT '',
  `Family` VARCHAR(45) NULL DEFAULT NULL COMMENT '',
  `version` VARCHAR(20) NULL DEFAULT NULL COMMENT '',
  PRIMARY KEY (`Id`),
  UNIQUE INDEX `DeviceId_UNIQUE` (`Id` ASC));

CREATE TABLE IF NOT EXISTS `siaamdb`.`User_Device` (
  `guid` VARCHAR(36) NOT NULL COMMENT '',
  `device_id` VARCHAR(45) NOT NULL COMMENT '',
  `created_by` VARCHAR(45) NOT NULL COMMENT '',
  `created_date` DATETIME NOT NULL COMMENT '',
  `updated_by` VARCHAR(45) NOT NULL COMMENT '',
  `updated_date` DATETIME NULL DEFAULT NULL COMMENT '',
  PRIMARY KEY (`guid`, `device_id`),
  INDEX `Id_idx` (`device_id` ASC),
  CONSTRAINT `device_id`
    FOREIGN KEY (`device_id`)
    REFERENCES `siaamdb`.`Device` (`Id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE);

ALTER TABLE `siaamdb`.`user` 
ADD UNIQUE INDEX `EMAIL_UNIQUE` (`EMAIL` ASC)  COMMENT '';

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
